﻿@{
    ViewData["Title"] = "Home Page";
}

<style>
    .dropArea {
        border: 2px dashed #CCC;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: border-color 0.3s;
        height: 300px;
        border-radius: 1rem;
    }
        .dropArea.highlight {
            border-color: #007bff;
        }
    .glyphicon-cloud-upload {
        font-size: 50px;
        color: #007bff;
    }
    .droptxt {
        font-size: 1.2rem;
        margin-top: 10px;
        color: #949494;
        margin: 0;
    }
    .areaArchivo :hover {
        background: #F2FAFD;
    }
</style>

<div class="text-center">
    <h1 class="display-4 mb-4">Documentos</h1>

    <form asp-action="UploadPdf" method="post" enctype="multipart/form-data">
        <div class="areaArchivo">
            <!-- Área de arrastrar y soltar -->
            <div aria-live="polite" class="dropArea d-flex justify-content-center align-items-center" id="dropArea">
                <input type="file" id="pdfFile" name="pdfFile" accept="application/pdf" required hidden multiple>

                <div>
                    <div>
                        <div>
                            <span aria-hidden="true" class="glyphicon glyphicon-cloud-upload"></span>
                        </div>
                        <i style="font-size: 50px; color: #949494;" class="fa-regular fa-file-pdf mb-1"></i>
                        <div class="droptxt">Arrastre o seleccione archivos PDF</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-2 text-center">
            <strong>Nombre de archivo:</strong> <span id="fileName">Ningún archivo seleccionado</span>
        </div>

        <!-- Botón de enviar (deshabilitado inicialmente) -->
        <div>
            <button type="button" id="uploadBtn" class="btn btn-primary mt-4" disabled>Subir PDF</button>
        </div>
    </form>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Detalle de Archivo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalBodyContent">
                   
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('pdfFile');
        const fileNameSpan = document.getElementById('fileName');
        const uploadBtn = document.getElementById('uploadBtn');
        const modalBodyContent = document.getElementById('modalBodyContent');
        const modalElement = document.getElementById('exampleModal');
        const modal = new bootstrap.Modal(modalElement);

        // Vincular el clic en el área grande de arrastrar y soltar para abrir el selector de archivos
        dropArea.addEventListener('click', function () {
            fileInput.click();  // Simular el clic en el input oculto
        });        

        // Capturar el cambio de selección de archivo
        fileInput.addEventListener('change', function (event) {
            const fileName = fileInput.files.length > 0 ? fileInput.files[0].name : 'Ningún archivo seleccionado'; // Capturar el nombre del archivo
            fileNameSpan.textContent = fileName;  // Mostrar el nombre del archivo seleccionado
            uploadBtn.disabled = fileName === 'Ningún archivo seleccionado';  // Habilitar/deshabilitar el botón
            modalBodyContent.innerHTML = "";  // Limpiar body de modal
            modal.hide();  // Ocultar modal
        });

        // Resaltar el área cuando el archivo se arrastra por encima
        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, (e) => {
                e.preventDefault();
                dropArea.classList.add('highlight');
            });
        });

        // Quitar el resaltado cuando el archivo deja el área
        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, (e) => {
                e.preventDefault();
                dropArea.classList.remove('highlight');
            });
        });

        // Manejar el drop
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;  // Asignar los archivos arrastrados al input
                const fileName = fileInput.files[0].name;  // Capturar el nombre del primer archivo arrastrado
                fileNameSpan.textContent = fileName;  // Mostrar el nombre del archivo
                modalBodyContent.innerHTML = "";  // Limpiar body de modal
                modal.hide();  // Ocultar modal
            }
        });

        // Mostrar el PDF en el modal cuando se haga clic en el botón de "Subir PDF"
        uploadBtn.addEventListener('click', function () {
            var formData = new FormData();
            var pdfFile = fileInput.files[0];

            if (!pdfFile) {
                alert("Por favor, selecciona un archivo PDF.");
                return;
            }

            formData.append('pdfFile', pdfFile);

            fetch('/Home/UploadPdf', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data) {
                        // Preparar body de modal
                        modalBodyContent.innerHTML = `
                        <div class="d-flex-column" id="areaDetalleArchivo">
                            <p><strong>Hash:</strong> ${data.hash}</p>
                            <p><strong>Fecha:</strong> ${data.date}</p>
                            <iframe src="data:application/pdf;base64,${data.pdfBase64}" style="width: 100%; height: 600px;" frameborder="0"></iframe>
                        </div>`;

                        modal.show();  // Mostrar el modal
                    } else {
                        alert("Error al subir el PDF.");
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    </script>
</div>
